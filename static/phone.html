<!doctype html
<html>
  <head>
    <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="js/reconnecting-websocket.min.js"></script>
    <title>phone</title>
  </head>
  <body>
    <pre class="output"></pre>
  </body>
<script>
  var output = document.querySelector('.output');
  window.addEventListener('deviceorientation', handleOrientation);
  function handleOrientation(event) {
    var x = event.beta;  // In degree in the range [-180,180]
    var y = event.gamma; // In degree in the range [-90,90]
    output.innerHTML  = "beta : " + x + "\n";
    output.innerHTML += "gamma: " + y + "\n";
  }
  if (window.location.protocol == "https:") {
    var ws_scheme = "wss://";
  } else {
    var ws_scheme = "ws://"
  };
  
  var myTimerID;
  var cnt=0;
  var ws_phone = new ReconnectingWebSocket(ws_scheme + location.host + "/phone");
  ws_phone.onopen = function() {
    console.log('ws_phone opened');
    myTimerID = setInterval(myTimerCB, 1000);
  }

  ws_phone.onclose = function() {
   console.log('ws_phone closed');
   clearInterval(myTimerID);
  }

  ws_phone.onmessage = function(message) {
      console.log("ws_phone: "+message.data);
      //var data = JSON.parse(message.data);
      //  if (data.type == "log"){
  }

  function myTimerCB() {
     var d = new Date();
     cnt=cnt+1;
     console.log(cnt);
     ws_phone.send("send->" + cnt)
  }
</script>


</html>
