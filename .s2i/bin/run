#!/bin/bash
source /opt/app-root/etc/generate_container_user

set -e

function is_gunicorn_installed() {
  hash gunicorn &>/dev/null
}

function is_django_installed() {
  python -c "import django" &>/dev/null
}

echo "============================================Before running application"
if is_gunicorn_installed; then
    echo "~~~ Detect gunicorn_installed ~~~"
elif is_django_installed; then
    echo "~~~ Detect django_installed ~~~"
else
    echo "~~~ No any web process installed ~~~"
fi
echo "ret: [$ret]"
echo "home: [$HOME]"
setup_py=$(find "$HOME" -maxdepth 2 -type f -name 'setup.py' -print -quit)
echo "setup_py: [$setup_py]"
echo "APP_CONFIG: [$APP_CONFIG]"
echo "APP_MODULE: [$APP_MODULE]"
#exec gunicorn "$APP_MODULE" --bind=0.0.0.0:8080 --access-logfile=- --config "$APP_CONFIG"
exec gunicorn "test:app" --bind=0.0.0.0:8080 --access-logfile=- -k flask_sockets.worker --workers=2
echo "============================================Before running application end"
#exec /usr/libexec/s2i/run
